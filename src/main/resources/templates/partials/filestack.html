<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <title>Title</title>-->

<!--</head>-->
<!--<body>-->
<!--<h1> Hello <span th:text="${user.getUsername()}"></span></h1>-->
<!--<div>-->
<!--  <button class="upload">Upload file</button>-->
<!--</div>-->
<!--<div>-->
<!--  <img th:src="${user.getImage()}" width="200" height="200" class="logo" />-->
<!--</div>-->
<!--</body>-->
<!--<script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>-->
<!--<script>-->

<!--  const button = document.querySelector('.upload')-->
<!--  const image = document.querySelector('.logo')-->
<!--  button.addEventListener('click', () => {-->
<!--    const apiKey = 'APaRx6LcnR9W7kXg7lQw2z'-->
<!--    const client = filestack.init(apiKey);-->
<!--    const options = {-->
<!--      onUploadDone: (uploadResponse) => {-->
<!--        console.log('onUploadDone', uploadResponse)-->
<!--        image.setAttribute('src', uploadResponse.filesUploaded[0].url)-->
<!--      }-->
<!--    };-->
<!--    client.picker(options).open()-->
<!--  })-->

<!--</script>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>Hello <span th:text="${user.username}"></span></h1>
<div>
    <button class="upload">Upload file</button>
</div>
<div>
    <img th:src="${user.image}" width="200" height="200" class="logo" />
</div>

<!-- Add a form to submit the uploaded image URL -->
<form id="imageForm" method="post" action="/filestack/upload">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <input type="hidden" name="fileURL" id="fileURLInput" />
</form>

<script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
<script>
    const button = document.querySelector('.upload');
    const image = document.querySelector('.logo');

    button.addEventListener('click', () => {
        const apiKey = 'APaRx6LcnR9W7kXg7lQw2z';
        const client = filestack.init(apiKey);
        const options = {
            onUploadDone: (uploadResponse) => {
                console.log('onUploadDone', uploadResponse);
                const fileURL = uploadResponse.filesUploaded[0].url;
                image.setAttribute('src', fileURL);

                // Submit the fileURL to the server via the form
                const fileURLInput = document.querySelector('#fileURLInput');
                fileURLInput.value = fileURL;
                document.getElementById('imageForm').submit();
            }
        };
        client.picker(options).open();
    });
</script>
</body>
</html>
